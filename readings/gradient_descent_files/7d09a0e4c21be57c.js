
            Do(function(){
            !function(){function e(){this.init()}var o=$(document),i=$("html"),n=$("body"),t={display_close:!0},s=['<div class="ui-overlay-mask" style="display:none;">','<div class="ui-overlay-x"></div>                   ','<div class="ui-overlay-container">                 ','  <a href="#" class="ui-overlay-close" style="display:none;">&times;</a> ','  <div class="hd"></div>                   ','  <div class="bd"></div>                   ',"</div>                                     ","</div>                                     "].join(""),a='<div class="ui-overlay-anchor"></div>';e.prototype={init:function(){var e=this;this.config=t,this.mask=$(s).appendTo(n),this.anchor=$(a).prependTo(n),this.container=this.mask.find(".ui-overlay-container"),this.header=this.mask.find(".ui-overlay-container > .hd"),this.body=this.mask.find(".ui-overlay-container > .bd"),this.bnClose=this.mask.find(".ui-overlay-container > .ui-overlay-close"),this.bnClose.click(function(o){o.preventDefault(),e.close()}),o.delegate(".ui-overlay-mask","click",function(o){e.config.forbidden_mask_click||o.target==e.container[0]||$.contains(e.container[0],o.target)||e.close()}),o.bind("keyup",function(o){e.config.forbidden_hotkey_cancel||/input|textarea/i.test(o.target.tagName)||27!==o.keyCode||e.close()})},open:function(e,n){var t=this.docTop=o.scrollTop();this.anchor.show().css({marginTop:-t}),i.addClass("ui-overlay-show"),this.mask.show(),this.config.display_close&&this.bnClose.show(),this.setContent(e||""),n&&n.call(this),this.container.trigger("overlay:open")},close:function(){i.removeClass("ui-overlay-show"),this.anchor.hide(),o.scrollTop(this.docTop),this.mask.hide(),this.container.trigger("overlay:close")},bind:function(e,o){this.container.bind(e,o)},setConfig:function(e){this.config=$.extend({},t,e||{})},setHeader:function(e){this.header.html(e)},setContent:function(e){this.body.html(e)}},$.overlay||($.overlay=new e)}(),function(){function e(e,o,i){var n=curTime=new Date;n.setTime(curTime.getTime()+i),document.cookie=e+"="+escape(o)+(null==i?"":";expires="+n.toGMTString())+";domain=.douban.com;path=/"}function o(e){if(document.cookie.length>0){var o,i=document.cookie.indexOf(e+"=");if(i!=-1)return i=i+e.length+1,o=document.cookie.indexOf(";",i),o==-1&&(o=document.cookie.length),unescape(document.cookie.substring(i,o))}return""}var i='<iframe src="javascript:;" frameborder="0" scrolling="no" width="{{width}}" height="{{height}}" name="{{name}}"></iframe>',n=478,t=480,s=function(e,o,i){var n={login:"https://accounts.douban.com/popup/login?source=sns",reg:"https://accounts.douban.com/popup/login?source=sns#popup_register",switch_user:"https://accounts.douban.com/popup/login?source=sns"},t=$.overlay.body.find("iframe");t.attr("src",n[e])},a=function(s){return function(a){a.preventDefault();var c=$(this),r=c.data(),l=r.params?"function"==typeof window[r.params]?window[r.params].call(this):r.params:null,d=self.location.href;l&&(d=d.indexOf("?")+1?d+"&"+l:d+"?"+l),r.width>$("body").width()&&(r.width=$("body").width());var h=i.replace("{{width}}",r.width||n).replace("{{height}}",r.height||t).replace("{{name}}",document.location.protocol+"//"+document.location.hostname);"undefined"!=typeof r.key&&o(r.key)||($.overlay.open(h,function(){s(encodeURIComponent(d),r.source)}),r.key&&r.cookie&&r.expired&&$.overlay.bind("overlay:close",function(){e(r.key,r.cookie,r.expired)}))}};$(document).delegate(".lnk-show-login","click",a(function(e,o){s("login",e,o)})).delegate(".lnk-show-reg","click",a(function(e,o){s("reg",e,o)})).delegate(".lnk-switch-user","click",a(function(e,o){s("switch_user",encodeURIComponent(e),o)})),$(window).bind("message",function(e){"https://accounts.douban.com"===e.originalEvent.origin&&$.overlay.body.find("iframe").css("height",e.originalEvent.data)})}();
            });
        ;
        Do(function(){
            function deferred(){var t={done:[],fail:[]},o={done:function(i){return t.done.push(i),o},fail:function(i){return t.fail.push(i),o}};return{resolve:function(){for(var o,i=0;o=t.done[i++];)o.apply(this,arguments)},reject:function(){for(var o,i=0;o=t.fail[i++];)o.apply(this,arguments)},promise:o}}function asyncRequest(t,o,i){var e=deferred(),d=null,a=(i||"get").toLowerCase();return d=$.ajax({url:t,type:a,dataType:"json",data:"post"===a?$.extend(o,{ck:get_cookie("ck")}):o,error:function(t){e.reject(t)},success:function(t){e.resolve(t)}}),e.promise.abort=function(){d&&d.abort()},e.promise}var DOULIST_ADDITEM="/j/doulist/{doulist_id}/additem",DOULIST_EDITITEM="/j/doulist/{doulist_id}/edititem",DOULIST_COMMENT="/j/doulist/{doulist_id}/poke",DOULIST_CREATE="/j/doulist/add",DOULIST_LIST="/j/doulist/cat",DOULIST_SEARCH="/j/doulist/search",DOULIST_SEARCH_SELF="/j/doulist/search_user_doulists",DOULIST_GET_ITEM_INFO="/j/doulist/get_item_info",addTooltipToDoulistBtn=function(t){if(get_cookie("ck")){var o=/^https?:\/\/\w+\.douban\.com\/link2\/\?url=(\S+)$/i,i=function(t){var i=t.match(o);return i?decodeURIComponent(i[1]):t};$(document).delegate(".url-doulist-add","click",function(t){t.preventDefault();var o,e=$(this),d=i(e.data("url")),a=dui.Dialog({title:"添加到豆列",width:640,cls:"dialog-doulist dialog-tooltip-loading",content:'<div class="tooltip-text">内容加载中<i class="tooltip-loading-icon"></i></div>'}).open();a.node.find(".dui-dialog-close").click(function(t){o&&o.abort()}),o=asyncRequest(DOULIST_GET_ITEM_INFO,{url:d},"post").done(function(t){return t.r?void a.node.find(".tooltip-text").text(t.error):(t.cate=(t.kind||"")+"",t.picture="string"==typeof t.images?t.images:t.images&&t.images[0]||"",t.id=(t.id||"")+"",a.close(),void e.doulistDialog(t))}).fail(function(t){a.node.find(".tooltip-text").text("失败啦！再试一次吧")})});var e=85,d=!1,a="doulist-tooltip-hide",n=$('<div class="doulist-add-tooltip"><a class="url-doulist-add" ><i></i> 添加到豆列</a><div class="arrow"></div></div>'),s=n.find("a");n.addClass(a),n.appendTo($("body"));var l=function(t){d=setTimeout(function(){n.addClass(a)},e)};$(t).mouseenter(function(t){var o=$(this);n.css({top:o.offset().top-28,left:t.pageX-42}),s.data("url",o.attr("href")),clearTimeout(d),n.removeClass(a)}).mouseleave(l),n.mouseenter(function(){clearTimeout(d)}).mouseleave(l)}};

            var $regUp = $('#reg-up');
            if ($regUp.length) {
                $regUp.find('.lnk-show-reg').trigger('click');
            }
            addTooltipToDoulistBtn('.note a[rel=nofollow]');
        });
        Do('https://img3.doubanio.com/f/sns/1dddb01fbe8256dc82a52056396143695938845c/js/sns/note/ng/render_gif.js', function() {
            if ('_IMAGE_GIF_RENDER' in window) {
                window._IMAGE_GIF_RENDER({
                preloadNum: 3
                });
            }
        });
    